<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Activation du compte</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../../src/adminStyle/adminStyle.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Allura&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="form">
      <div class="logo" width="15%">
        <a href="../../index.html">
          <img src="../../img/logo gite blanc.webp" alt="Logo Gîte Lorlavie" />
        </a>
      </div>
      <h1>Activation de votre compte</h1>
      <div class="form">
        <div id="activation-message" class="message-container"></div>
      </div>
    </div>
    <script>
      // Récupère le token dans l'URL
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");
      const messageDiv = document.getElementById("activation-message");

      if (token) {
        fetch(`${process.env.API_URL}/api/auth/activate/${token}`)
          .then((res) => res.json())
          .then((data) => {
            if (
              data.message &&
              (data.message.includes("succès") ||
                data.message.includes("succes"))
            ) {
              messageDiv.innerHTML = `
  <div class="card card-brown" style="min-width: 320px; margin: 2rem auto; padding: 2rem; text-align: center;">
    <p style="color: white; font-weight: bold; font-size: 1.2rem;">${data.message}</p>
    <p style="color: white; margin: 1rem 0;">
      Redirection vers la page de connexion
    </p>
    <div class="button-container" style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: center;">
      <a href="login.html" class="button-brown">Aller à la connexion maintenant</a>
    </div>
  </div>
`;
            } else {
              messageDiv.innerHTML = `
  <div class="card card-brown" style="min-width: 320px; margin: 2rem auto; padding: 2rem; text-align: center;">
    <p style="color: white; font-weight: bold; font-size: 1.2rem;">
      ${data.message || "Erreur lors de l'activation"}
    </p>
    <div class="button-container" style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: center;">
      <a href="login.html" class="button-brown">Aller à la connexion</a>
    </div>
  </div>
`;
            }
          })
          .catch((error) => {
            console.error("Erreur", error);
            messageDiv.innerHTML = `
  <div class="card card-brown" style="min-width: 320px; margin: 2rem auto; padding: 2rem; text-align: center;">
    <p style="color: #ff4d4d; font-weight: bold; font-size: 1.2rem;">
      Erreur lors de l'activation du compte.
    </p>
    <p style="color: white; margin-bottom: 2rem;">
      Veuillez réessayer ou contacter l'administrateur.
    </p>
    <div class="button-container" style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: center;">
      <a href="login.html" class="button-white">Retour à la connexion</a>
    </div>
  </div>
`;
          });
      } else {
        messageDiv.innerHTML = `
  <div class="card card-brown" style="max-width: 400px; margin: 2rem auto; padding: 2rem; text-align: center;">
    <p style="color: #ff4d4d; font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">
      Lien d'activation invalide ou manquant.
    </p>
    <p style="color: white; margin-bottom: 2rem;">
      Vérifiez que vous avez bien copié le lien complet depuis votre email.
    </p>
    <div class="button-container" style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
      <a href="login.html" class="button-brown">Aller à la connexion</a>
      <a href="register.html" class="button-white">Créer un nouveau compte</a>
    </div>
  </div>
`;
      }
    </script>
  </body>
</html>
